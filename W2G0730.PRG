* Program Name: W2G0730
* Author:       David M. Wysocki
* Company:      Diversified Technical Service, Inc.
* Client:       Palm Beach Kennal Club
* Purpose:      Database Error Reporting - Duplicate PAYEE records.
*
*
FUNCTION W2G0730()
MEMVAR GETLIST
SET ESCAPE ON
SET SAFETY OFF
M->REC_ID   = SPACE(9)
M->NAME     = SPACE(32)
M->ADDRESS  = SPACE(30)
M->CITY     = SPACE(25)
M->STATE    = SPACE(2)
M->ZIP      = SPACE(5)
M->FIRST_ID = SPACE(15)
M->SCND_ID  = SPACE(15)
M->R_DATE   = DATE()
M->TIME     = SPACE(8)
M->P_NUMBER = 0
M->L_NUMBER = 0

SELECT 1
USE PAYEE INDEX PAYEE
SELECT 2
USE RPT0730

CLEAR

@ 0,10 SAY 'DATABASE ERROR REPORT - DUPLICATE PAYEE RECORDS.'
@ 2,10 SAY '1 - RE-PRINT PREVIOUS ERROR REPORT.'
@ 4,10 SAY '2 - CREATE NEW REPORT. OLD ERROR REPORT WILL BE DELETED.'
@ 6,10 SAY '3 - EXIT MENU.'

M->CHOICE = ' '

DO WHILE .NOT. M->CHOICE$'123'
   M->CHOICE = ' '
   @ 8,10 GET M->CHOICE PICTURE '9'
   READ
ENDDO

IF M->CHOICE = '3'
   CLEAR
   CLOSE DATABASES
   RETURN (NIL)
ENDIF

SET PRINTER TO C:\TEMP\W2G0730.TXT
m->printer_init := 'e(10u&l1o&l8d&l5e&l66f&k2s(s8v'

IF M->CHOICE = '1'
   SELECT 2
   GOTO TOP
   SET DEVICE TO PRINTER
   @ 0,0 say m->printer_init
   DO W2G0735
   DO WHILE .NOT. EOF()
      @  M->L_NUMBER, 01  SAY RPT0730->RECORD_ID
      @  M->L_NUMBER, 15  SAY RPT0730->NAME
      @  M->L_NUMBER, 55  SAY RPT0730->FIRST_ID
      @  M->L_NUMBER, 75  SAY RPT0730->SECOND_ID
      M->L_NUMBER = M->L_NUMBER + 1
      @  M->L_NUMBER, 15  SAY RPT0730->ADDRESS
      M->L_NUMBER = M->L_NUMBER + 1
      @  M->L_NUMBER, 15  SAY LTRIM(RTRIM(RPT0730->CITY))  + ', ' + ;
                              LTRIM(RTRIM(RPT0730->STATE)) + ' '  + ;
                                          RPT0730->ZIP
      M->L_NUMBER = M->L_NUMBER + 2
      IF M->L_NUMBER > 58
         DO W2G0735
      ENDIF
      SKIP
   ENDDO
   EJECT
   SET DEVICE TO SCREEN
   CLEAR
   CLOSE DATABASES
   RETURN (NIL)
ENDIF

@ 24,0 SAY "VERIFY THAT YOU WANT TO CREATE A NEW REPORT BY RE-ENTERING '2'."
M->CHOICE = ' '

DO WHILE .NOT. M->CHOICE$'123'
   M->CHOICE = ' '
   @ 8,10 GET M->CHOICE PICTURE '9'
   READ
ENDDO

IF M->CHOICE <> '2'
   CLEAR
   CLOSE DATABASES
   RETURN (NIL)
ENDIF

SELECT 2
ZAP
SELECT 1

CLEAR

@ 1,20 SAY 'REPORT START TIME: '
M->TIME = TIME()
@ 1,40 SAY M->TIME
@ 3,20 SAY 'CREATING REPORT. ONE MOMENT PLEASE.'
M->REC_ID = PAYEE->RECORD_ID
SKIP
DO WHILE .NOT. EOF()
   IF PAYEE->RECORD_ID = M->REC_ID
      M->REC_ID = PAYEE->RECORD_ID
      IF PAYEE->MIDDLE_INT = ' '
         M->NAME = LTRIM(RTRIM(PAYEE->LAST_NAME))  +', '+ ;
                   LTRIM(RTRIM(PAYEE->FIRST_NAME))
      ELSE
         M->NAME = LTRIM(RTRIM(PAYEE->LAST_NAME))  +', '+ ;
                   LTRIM(RTRIM(PAYEE->FIRST_NAME)) +' ' + ;
                   LTRIM(RTRIM(PAYEE->MIDDLE_INT))
      ENDIF
      M->ADDRESS = PAYEE->ADDRESS
      M->CITY    = PAYEE->CITY
      M->STATE   = PAYEE->STATE
      M->ZIP     = PAYEE->ZIP
      M->FIRST_ID= PAYEE->FIRST_ID
      M->SCND_ID = PAYEE->SECOND_ID
      DELETE
      SELECT 2
      APPEND BLANK
      REPLACE RPT0730->RECORD_ID WITH M->REC_ID
      REPLACE RPT0730->NAME      WITH M->NAME
      REPLACE RPT0730->ADDRESS   WITH M->ADDRESS
      REPLACE RPT0730->CITY      WITH M->CITY
      REPLACE RPT0730->STATE     WITH M->STATE
      REPLACE RPT0730->ZIP       WITH M->ZIP
      REPLACE RPT0730->FIRST_ID  WITH M->FIRST_ID
      REPLACE RPT0730->SECOND_ID WITH M->SCND_ID
      M->REC_ID   = SPACE (9)
      M->NAME     = SPACE (32)
      M->ADDRESS  = SPACE (30)
      M->CITY     = SPACE (25)
      M->STATE    = SPACE (2)
      M->ZIP      = SPACE (5)
      M->FIRST_ID = SPACE(15)
      M->SCND_ID  = SPACE(15)
   ENDIF
   SELECT 1
   M->REC_ID = PAYEE->RECORD_ID
   SKIP
ENDDO
SELECT 2
GOTO TOP

SET DEVICE TO PRINTER

@ 0,0 say m->printer_init

DO W2G0735

DO WHILE .NOT. EOF()
   @  M->L_NUMBER, 01  SAY RPT0730->RECORD_ID
   @  M->L_NUMBER, 15  SAY RPT0730->NAME
   @  M->L_NUMBER, 55  SAY RPT0730->FIRST_ID
   @  M->L_NUMBER, 75  SAY RPT0730->SECOND_ID
   M->L_NUMBER = M->L_NUMBER + 1
   @  M->L_NUMBER, 15  SAY RPT0730->ADDRESS
   M->L_NUMBER = M->L_NUMBER + 1
   @  M->L_NUMBER, 15  SAY LTRIM(RTRIM(RPT0730->CITY))  + ', ' + ;
                           LTRIM(RTRIM(RPT0730->STATE)) + ' '  + ;
                                       RPT0730->ZIP
   M->L_NUMBER = M->L_NUMBER + 2
   IF M->L_NUMBER > 58
      DO W2G0735
   ENDIF
   SKIP
ENDDO

EJECT

SELECT 1
SET INDEX TO PAYEE, NAME
PACK
SET DEVICE TO SCREEN
@  5,20 SAY 'REPORT COMPLETE.'
@  7,20 SAY 'REPORT END TIME: '
M->TIME = TIME()
@  7,40 SAY M->TIME
WAIT
CLOSE DATABASES
RETURN (NIL)
* EOF W2G0730.PRG
