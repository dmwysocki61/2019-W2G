* Program Name: W2G0710
* Author:       David M. Wysocki
* Company:      Diversified Technical Service, Inc.
* Client:       Palm Beach Kennal Club
* Purpose:      Database Error Reporting - Unmatched PAYEE records.
*
*
FUNCTION W2G0710()
MEMVAR GETLIST
SET ESCAPE ON
M->REC_ID   = SPACE(9)
M->NAME     = SPACE(32)
M->ADDRESS  = SPACE(30)
M->CITY     = SPACE(25)
M->STATE    = SPACE(2)
M->ZIP      = SPACE(5)
M->FIRST_ID = SPACE(15)
M->SCND_ID  = SPACE(15)
M->P_NUMBER   = 0
M->L_NUMBER   = 0
M->CHOICE   = ' '
M->TIME     = SPACE (8)
SET SAFETY OFF

SELECT 1
USE PAYEE
SET INDEX TO PAYEE

SELECT 2
USE TICKET
SET INDEX TO TICKET

SELECT 3
USE RPT0710

CLEAR
@  0,10  SAY 'DATABASE ERROR REPORT - UNMATCHED PAYEE RECORDS'
@  2,10  SAY '1 - RE-PRINT PREVIOUS ERROR REPORT.'
@  4,10  SAY '2 - CREATE NEW ERROR REPORT. OLD REPORT WILL BE DELETED.'
@  6,10  SAY '3 - EXIT REPORT.'
M->CHOICE = ' '
DO WHILE .NOT. M->CHOICE $'123'
   M->CHOICE = ' '
   @ 8,10 GET M->CHOICE PICTURE '9'
   READ
ENDDO
IF M->CHOICE = '3'
   CLEAR
   CLOSE DATABASES
   RETURN (NIL)
ENDIF
SET PRINTER TO ("C:\TEMP\W2G0710.TXT")

IF M->CHOICE = '1'
   CLEAR
   @ 7,15 SAY 'PRINTING REPORT. ONE MOMENT PLEASE.'
   SET DEVICE TO PRINTER

   m->printer_init := 'e(10u&l1o&l8d&l5e&l66f&k2s(s8v'
   @ 0,0 say m->printer_init

   SELECT 3
   GOTO TOP

   DO W2G0715
   DO WHILE .NOT. EOF()
      @  M->L_NUMBER, 01  SAY RPT0710->NAME
      @  M->L_NUMBER, 40  SAY RPT0710->RECORD_ID
      @  M->L_NUMBER, 55  SAY RPT0710->FIRST_ID
      @  M->L_NUMBER, 75  SAY RPT0710->SECOND_ID
      M->L_NUMBER = M->L_NUMBER + 1
      @  M->L_NUMBER, 01  SAY RPT0710->ADDRESS
      M->L_NUMBER = M->L_NUMBER + 1
      @  M->L_NUMBER, 01  SAY LTRIM(RTRIM(RPT0710->CITY))  + ', ' + ;
                              LTRIM(RTRIM(RPT0710->STATE)) + ' '  + ;
                                          RPT0710->ZIP
      M->L_NUMBER = M->L_NUMBER + 2
      IF M->L_NUMBER > 58
         DO W2G0715
      ENDIF
      SKIP
   ENDDO
   EJECT
   SET DEVICE TO SCREEN
   CLEAR
   CLOSE DATABASES
   RETURN (NIL)
ENDIF

@ 24,0 SAY "VERIFY THAT YOU WISH TO CREATE A NEW REPORT BY RE-ENTERING '2'."
M->CHOICE = ' '

DO WHILE .NOT. M->CHOICE $'123'
   M->CHOICE = ' '
   @ 8,10 GET M->CHOICE PICTURE '9'
   READ
ENDDO

IF M->CHOICE <> '2'
   CLEAR
   CLOSE DATABASES
   RETURN (NIL)
ENDIF

CLEAR

M->TIME = TIME()
@  1,20 SAY 'REPORT START TIME: '
@  1,40 SAY M->TIME
@  3,20 SAY 'REBUILDING PAYEE INDEXES. ONE MOMENT PLEASE.'

SELECT 1
PACK
GOTO TOP

@  5,20 SAY 'REBUILDING TICKET INDEXES. ONE MOMENT PLEASE.'

SELECT 2
PACK

SELECT 3
ZAP

SELECT 1

@  7,20 SAY 'CREATING REPORT. ONE MOMENT PLEASE.'

DO WHILE .NOT. EOF()
   M->REC_ID = PAYEE->RECORD_ID
   SELECT 2
   SEEK M->REC_ID
   IF EOF()
      SELECT 1
      IF PAYEE->MIDDLE_INT = ' '
         M->NAME = LTRIM(RTRIM(PAYEE->LAST_NAME))  +', '+ ;
                   LTRIM(RTRIM(PAYEE->FIRST_NAME))
      ELSE
         M->NAME = LTRIM(RTRIM(PAYEE->LAST_NAME))  +', '+ ;
                   LTRIM(RTRIM(PAYEE->FIRST_NAME)) +' ' + ;
                   LTRIM(RTRIM(PAYEE->MIDDLE_INT))
      ENDIF
      M->ADDRESS = PAYEE->ADDRESS
      M->CITY    = PAYEE->CITY
      M->STATE   = PAYEE->STATE
      M->ZIP     = PAYEE->ZIP
      M->FIRST_ID= PAYEE->FIRST_ID
      M->SCND_ID = PAYEE->SECOND_ID
      DELETE
      SELECT 3
      APPEND BLANK
      REPLACE RPT0710->NAME       WITH M->NAME
      REPLACE RPT0710->RECORD_ID  WITH M->REC_ID
      REPLACE RPT0710->ADDRESS    WITH M->ADDRESS
      REPLACE RPT0710->CITY       WITH M->CITY
      REPLACE RPT0710->STATE      WITH M->STATE
      REPLACE RPT0710->ZIP        WITH M->ZIP
      REPLACE RPT0710->FIRST_ID   WITH M->FIRST_ID
      REPLACE RPT0710->SECOND_ID  WITH M->SCND_ID
      M->REC_ID  = SPACE (9)
      M->NAME    = SPACE (32)
      M->ADDRESS = SPACE (30)
      M->CITY    = SPACE (25)
      M->STATE   = SPACE (2)
      M->ZIP     = SPACE (5)
      M->FIRST_ID= SPACE(15)
      M->SCND_ID = SPACE(15)
   ENDIF
   SELECT 1
   SKIP
ENDDO

@ 9,20 SAY 'SPOOLING REPORT TO PRINTER.'

SELECT 3

GOTO TOP

SET DEVICE TO PRINTER
m->printer_init := 'e(10u&l1o&l8d&l5e&l66f&k2s(s8v'
@ 0,0 say m->printer_init

DO W2G0715

DO WHILE .NOT. EOF()
   @  M->L_NUMBER, 01  SAY RPT0710->NAME
   @  M->L_NUMBER, 40  SAY RPT0710->RECORD_ID
   @  M->L_NUMBER, 55  SAY RPT0710->FIRST_ID
   @  M->L_NUMBER, 75  SAY RPT0710->SECOND_ID
   M->L_NUMBER = M->L_NUMBER + 1
   @  M->L_NUMBER, 01  SAY RPT0710->ADDRESS
   M->L_NUMBER = M->L_NUMBER + 1
   @  M->L_NUMBER, 01  SAY LTRIM(RTRIM(RPT0710->CITY))  + ', ' + ;
                           LTRIM(RTRIM(RPT0710->STATE)) + ' '  + ;
                                       RPT0710->ZIP
   M->L_NUMBER = M->L_NUMBER + 2
   IF M->L_NUMBER > 58
      DO W2G0715
   ENDIF
   SKIP
ENDDO

EJECT

SELECT 1
SET INDEX TO PAYEE, NAME

PACK
SET DEVICE TO SCREEN

@  11,20 SAY 'REPORT COMPLETE.'
M->TIME = TIME()
@ 13,20 SAY 'REPORT END TIME: '
@ 13,40 SAY M->TIME
set printer to
WAIT
CLOSE DATABASES
RETURN (NIL)
* EOF W2G0710.PRG
